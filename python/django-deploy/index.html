<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Center OS Django部署 - Thomas Woo</title><meta description="Center OS 部署 Django 程序，使用 Nginx + uWsgi + Supervisor"><meta property="og:type" content="blog"><meta property="og:title" content="Center OS Django部署"><meta property="og:url" content="http://smileorigin.site/python/django-deploy/"><meta property="og:site_name" content="Thomas Woo"><meta property="og:description" content="Center OS 部署 Django 程序，使用 Nginx + uWsgi + Supervisor"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231025.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231041.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231153.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231233.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231443.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231457.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231510.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231521.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231543.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231552.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231604.png"><meta property="article:published_time" content="2018-11-14T06:00:00.000Z"><meta property="article:modified_time" content="2020-06-20T07:41:10.556Z"><meta property="article:author" content="Thomas Woo"><meta property="article:tag" content="Python"><meta property="article:tag" content="Django"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="uWsgi"><meta property="article:tag" content="Supervisor"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231025.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://smileorigin.site/python/django-deploy/"},"headline":"Thomas Woo","image":["https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231025.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231041.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231153.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231233.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231443.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231457.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231510.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231521.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231543.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231552.png","https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231604.png"],"datePublished":"2018-11-14T06:00:00.000Z","dateModified":"2020-06-20T07:41:10.556Z","author":{"@type":"Person","name":"Thomas Woo"},"description":"Center OS 部署 Django 程序，使用 Nginx + uWsgi + Supervisor"}</script><link rel="canonical" href="http://smileorigin.site/python/django-deploy/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?33cec7dfd968d9ffd9ff2a5da2be77d0";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-110922455-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-110922455-1');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><script type="text/javascript" src="/js/dark.js"></script><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">SMILEORIGIN</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/bbs">BBS</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" id="dark-switch" title="Dark Mode" href="javascript:;"><i class="fas fa-moon" id="dark-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-widescreen is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-11-14T06:00:00.000Z" title="2018-11-14T06:00:00.000Z">2018-11-14</time><span class="level-item"><a class="link-muted" href="/categories/Python/">Python</a></span><span class="level-item">18 分钟 读完 (大约 2661 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Center OS Django部署</h1><div class="content"><p>Center OS 部署 Django 程序，使用 Nginx + uWsgi + Supervisor</p>
<a id="more"></a>

<h2 id="Python3-环境安装"><a href="#Python3-环境安装" class="headerlink" title="Python3 环境安装"></a>Python3 环境安装</h2><ol>
<li>安装可能使用到的依赖<br> <code>yum install openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel</code></li>
<li>从Python官网找到需要的Python版本的下载路径，使用<code>wget</code>下载到服务器<br> 这里以Python3.6.7为例：<a href="https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz">https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz</a><br> 下载到服务器命令：<code>wget https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz</code></li>
<li>解压tgz压缩包<br> <code>tar -zxvf Python-3.6.7.tgz</code><br> 解压完可以在当前目录下看到Python-3.6.7的目录</li>
<li>把Python移到 <strong>/usr/local</strong> 下<br> <code>mv Python-3.6.7 /usr/local</code></li>
<li>进入Python-3.6.7目录<br> <code>cd /usr/local/Python-3.6.7</code></li>
<li>配置<br> <code>./configure</code></li>
<li>编译<br> <code>make</code></li>
<li>安装<br> <code>make install</code></li>
<li>创建软链接（以便在全局调用）<br> <code>ln -s /usr/local/bin/python3.6 /usr/bin/python3</code></li>
<li>查看是否安装成功<br><code>python3 -V</code><br><img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231025.png" alt=""></li>
</ol>
<h2 id="将项目传到到服务器"><a href="#将项目传到到服务器" class="headerlink" title="将项目传到到服务器"></a>将项目传到到服务器</h2><p>这里我们使用Git来操作，我们把项目传到如：Github或Coding等代码仓库，然后使用Git克隆到服务器。这样每次项目更新了只要将代码上传到仓库，在到服务器将代码拉下来就可以实现代码更新了</p>
<ol>
<li>项目配置<br> 记得在项目的<strong>settings.py</strong>中添加以下配置 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'你的公网ip(不带端口号)'</span>] <span class="comment"># 如果不配置服务器的IP地址将导致外网无法访问，或者使用['*']代表授权全部</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'static'</span>)</span><br></pre></td></tr></table></figure></li>
<li>安装Git<br> <code>yum install git</code></li>
<li>克隆项目到服务器<br> <code>git clone http://xxxxxx.com</code>，将<code>http://xxxxxx.com</code>换成自己仓库的地址</li>
<li>拉取更新的代码<br> <code>git pull</code></li>
<li>更多<br> 更多的Git命令可以查看我另一篇文章：<a href="https://smileorigin.site/2017/10/18/Git/Git/">https://smileorigin.site/2017/10/18/Git/Git/</a></li>
</ol>
<h2 id="使用Virtualenv来创建虚拟环境"><a href="#使用Virtualenv来创建虚拟环境" class="headerlink" title="使用Virtualenv来创建虚拟环境"></a>使用Virtualenv来创建虚拟环境</h2><p>为每一个Django项目都创建一个虚拟环境可以使每个项目的依赖包都互不影响，也不会污染全局环境，其他使用和信息可以查看我的另一篇文章–<a href="https://smileorigin.site/2018/08/06/Python/Virtualenv/">https://smileorigin.site/2018/08/06/Python/Virtualenv/</a></p>
<ol>
<li>更新pip<br> <code>pip3 install --upgrade pip</code></li>
<li>安装Virtualenv<br> <code>pip3 install virtualenv</code></li>
<li>进入项目所在文件夹<br> 假设我们项目文件夹在当前目录且名称为<code>server</code><br> <code>cd server</code></li>
<li>创建虚拟环境<br> 在当前文件夹下创建一个名为<strong>venv</strong>的虚拟环境<br> <code>virtualenv venv</code></li>
<li>激活虚拟环境<br> <code>source venv/bin/activate</code><br> 可以看到在<strong>root</strong>之前多了个<strong>(venv)</strong>，说明激活虚拟环境成功了<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231041.png" alt=""></li>
<li>使用<code>requirements.txt</code>文件安装依赖包<br> 如果有使用<code>pip freeze &gt;requirements.txt</code>在本地项目导出项目的所有依赖包，则可以通过该命令进行快速安装依赖包，没有的话就手动使用pip安装项目需要的依赖包<br> <code>pip install -r requirements.txt</code></li>
</ol>
<h2 id="安装配置uWsgi"><a href="#安装配置uWsgi" class="headerlink" title="安装配置uWsgi"></a>安装配置uWsgi</h2><ol>
<li>安装<br> <code>pip install uwsgi</code></li>
<li>测试uwsgi<br> <code>vim test.py</code><br> 填写以下内容   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(env, start_response)</span>:</span></span><br><span class="line">   start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])</span><br><span class="line">   <span class="keyword">return</span> [<span class="string">b'Hello world'</span>]  <span class="comment"># Python3</span></span><br></pre></td></tr></table></figure>
 保存后，执行指令进行测试：<code>uwsgi --http 127.0.0.1:8000 --wsgi-file test.py</code><br> 如果执行成功，则会有以下类似信息：<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231153.png" alt=""><br> 打开另一个命令行窗口，输入以下命令进行测试：<code>curl 127.0.0.1:8000</code><br> 如果提示以下信息则表示测试页面运行成功：<br> 可以看到截图有显示：<code>Hello world</code><br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231233.png" alt=""></li>
<li>新建uwsgi配置文件<br> <code>vim uwsgi.ini</code><br> 可以按照以下模板进行填写   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 我的项目目录</span></span><br><span class="line">chdir = /root/server</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定项目的application</span></span><br><span class="line">module = imageAnalyze.wsgi</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进程个数</span></span><br><span class="line">workers = 5</span><br><span class="line"><span class="meta">#</span><span class="bash">pid文件保存路径</span></span><br><span class="line">pidfile = /root/server/uwsgi/uwsgi.pid</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定IP端口</span></span><br><span class="line">http = 127.0.0.1:8000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定静态文件</span></span><br><span class="line">static-map = /static=/root/server/static</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动uwsgi的用户名和用户组</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用主进程</span></span><br><span class="line">master = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 自动移除unix Socket和pid文件当服务停止的时候</span></span><br><span class="line">vacuum = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 序列化接受的内容，如果可能的话</span></span><br><span class="line">thunder-lock = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用线程</span></span><br><span class="line">enable-threads = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置自中断时间</span></span><br><span class="line">harakiri = 30</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置缓冲</span></span><br><span class="line">post-buffering = 4096</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置日志目录</span></span><br><span class="line">daemonize = /root/server/uwsgi/uwsgi.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定sock的文件路径</span></span><br><span class="line">socket = /root/server/uwsgi/uwsgi.sock</span><br></pre></td></tr></table></figure></li>
<li>新建配置文件中的指定文件夹<br> 如果不创建可能导致以配置文件启动uwsgi报文件夹不存在的错误<br> <code>mkdir uwsgi</code></li>
<li>创建static文件夹<br> <code>mkdir static</code></li>
<li>收集项目静态文件<br> <code>python manage.py collectstatic</code><br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231443.png" alt=""><br> 收集成功会提示收集的文件数</li>
<li>以配置文件的形式启动uwsgi<br> <code>uwsgi --ini uwsgi.ini</code><br> 如果启动成功，则有以下类似提示<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231457.png" alt=""><br> 使用<code>netstat -tnlp</code>命令可以查看在有哪些端口是运行的，可以看到uwsgi运行在<strong>127.0.0.1:8000</strong><br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231510.png" alt=""></li>
<li>关闭<br><code>uwsgi --stop uwsgi/uwsgi.pid</code></li>
</ol>
<h2 id="安装配置Nginx"><a href="#安装配置Nginx" class="headerlink" title="安装配置Nginx"></a>安装配置Nginx</h2><p>记得在配置Nginx的时候如果使用的是阿里云服务器，要让外部使用的端口要先在阿里云服务器的安全组中打开，否则会不能访问</p>
<ol>
<li>查找要安装的Nginx的包链接<br> <a href="http://nginx.org/packages/centos/7/x86_64/RPMS/">http://nginx.org/packages/centos/7/x86_64/RPMS/</a></li>
<li>安装<br> <code>rpm -ivh http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.14.1-1.el7_4.ngx.x86_64.rpm</code></li>
<li>配置Django项目的Nginx配置文件<br> <code>cd /etc/nginx/conf.d</code><br> <code>vim server.conf</code>，创建你项目的Nginx的配置文件，把<code>server</code>换成任意名字（<code>/etc/nginx/nginx.conf</code>文件的最后一行是<code>include /etc/nginx/conf.d/*.conf;</code>会加载<code>/etc/nginx/conf.d</code>文件夹下的所有后缀为<code>.conf</code>的配置文件，所以只要在这个目录下创建后缀为<code>.conf</code>的配置文件并配置相关内容，Nginx就会自动帮我们加载了，不需要额外的处理） <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">   listen 80; # 监听的端口</span><br><span class="line">   server_name cookbook.aicircle.site;</span><br><span class="line">   server_name www.cookbook.aicircle.site # 使外部可通过www.cookbook.aicircle.site进行访问</span><br><span class="line"><span class="meta">   #</span><span class="bash">当请求这些server name的时候，nginx才会做反向代理，0.0.0.0是指全部</span></span><br><span class="line">   location / &#123;</span><br><span class="line">     proxy_pass http://127.0.0.1:8000;</span><br><span class="line">     proxy_set_header Host $host;</span><br><span class="line">     proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">     proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> location 顾名思义，定位，就是当访问 / 的时候，nginx会将请求转给本地的8080&gt;端口，而后面的设置都是&gt;一些基本的配置，可以直接用</span></span><br><span class="line">   location /static &#123;</span><br><span class="line">     alias /root/server/static;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 这个就是配置静态文件的地方，要用绝对地址，对应最开始的目录形式，假设project就在/home下面，那么这&gt;样配置就可以的了，还有个前提是，你在开发的时候，采取了django的建议，每个app的静态文件都用多了一层app_name的文件夹来包住。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>查看Nginx状态<br> <code>systemctl status nginx</code>，如果Nginx是启动的则会有以下类似提示：<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231521.png" alt=""></li>
<li>测试Nginx配置文件是否有误<br> <code>nginx -t</code>，如果有以下类似提示，则配置文件没错<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231543.png" alt=""></li>
<li>启动Nginx<br> <code>systemctl start nginx</code></li>
<li>测试是否启动成功<br> <code>curl http://127.0.0.1:80</code>，如果Nginx启动成功，则会显示以下类似内容<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231552.png" alt=""></li>
<li>设置开机自启<br> <code>systemctl enable nginx</code>，如果设置成功则会有类似提示信息<br> <img src="https://cdn.jsdelivr.net/gh/smileorigin/images/2020/20200204231604.png" alt=""></li>
<li>关闭Nginx<br> <code>systemctl stop nginx</code></li>
<li>重启Nginx<br><code>systemctl restart nginx</code></li>
</ol>
<h2 id="使用Supervisor来管理进程"><a href="#使用Supervisor来管理进程" class="headerlink" title="使用Supervisor来管理进程"></a>使用Supervisor来管理进程</h2><blockquote>
<p>Supervisor是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。它是通过fork/exec的方式把这些被管理的进程当作supervisor的子进程来启动，这样只要在supervisor的配置文件中，把要管理的进程的可执行文件的路径写进去，就可以实现当子进程挂掉的时候，父进程可以准确获取子进程挂掉的信息，可以选择是否重新启动程序或报警。supervisor还提供了一个功能，可以为supervisord或者每个子进程，设置一个非root的user，这个user就可以管理它对应的进程。</p>
</blockquote>
<ol>
<li>安装<br> 安装我们使用Center OS自带的Python2来安装，Supervisor不支持Python3，打开另一个命令窗口使用以下命令安装<br> <code>pip2 install supervisor</code></li>
<li>设置配置文件<br> <code>vim supervisord.conf</code>，在任意你想要的位置创建配置文件，根据说明将以下参数改为自己的配置，保存 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[program:server]</span><br><span class="line">command=/root/server/venv/bin/uwsgi --ini /root/server/uwsgi.ini</span><br><span class="line">directory=/root/server </span><br><span class="line">startsecs=1 </span><br><span class="line">stopwaitsecs=1 </span><br><span class="line">autostart=true </span><br><span class="line">autorestart=true </span><br><span class="line">[supervisord]</span><br><span class="line">[supervisorctl]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>program:server</code>：指定程序名称，<code>server</code>为自定义程序名称</li>
<li><code>command</code>：启动程序的命令，这里是调用虚拟环境内的uwsgi根据配置文件<code>/root/server/uwsgi.ini</code>启动Django程序</li>
<li><code>directory</code>：项目所在的文件夹</li>
<li><code>startsecs</code>：启动延迟</li>
<li><code>stopwaitsecs</code>：关闭延迟</li>
<li><code>autostart</code>：是否自动启动</li>
<li><code>autorestart</code>：是否自动重启</li>
</ul>
</li>
<li>启动Supervisor<br> supervisord是服务端，supervisorctl是客户端<br> <code>supervisord -c supervisord.conf</code>，如果<code>surpervisord.conf</code>不在当前文件夹则需要其绝对路径（如：<code>/etc/xx/supervisord.conf</code>）</li>
<li>重启supervisor<br> <code>service supervisord restart</code></li>
<li>启动进程<br> <code>supervisorctl -c supervisord.conf start server</code></li>
<li>重启进程<br> <code>supervisorctl -c supervisord.conf restart server</code></li>
<li>关闭进程<br> <code>supervisorctl -c supervisord.conf stop server</code></li>
<li>启动所有进程<br> <code>supervisorctl start all</code></li>
<li>关闭所有进程<br> <code>supervisorctl stop all</code></li>
<li>查看所有进程的状态<br><code>supervisorctl status</code></li>
<li>查看Supervisor的进程信息<br><code>ps -ef | grep supervisord</code></li>
</ol>
<h2 id="错误解决方案"><a href="#错误解决方案" class="headerlink" title="错误解决方案"></a>错误解决方案</h2><ul>
<li>如果以上都配置好了，发现进入网站静态文件无法正常加载，请确认你的项目是不是在<code>/root</code>文件夹下，如果是的话则在修改<code>root</code>目录的权限<br>  <code>chmod -R 755 root</code><br>  修改完后重启Nginx服务器重新访问网站即可</li>
<li>无法访问服务器（博主这边用的是阿里云服务器，默认防火墙是关闭的）<ol>
<li>检查服务器防火墙是否将用到的端口都设为白名单</li>
<li>如果是阿里云服务器，检查安全组是否添加用到的端口为入方向白名单</li>
</ol>
</li>
</ul>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://blog.csdn.net/wjy397/article/details/51610872">超详细的django1.8处理centos下nginx上处理静态文件步骤！</a></li>
<li><a href="https://www.cnblogs.com/EasonJim/p/9020896.html">CentOS 6.9/7通过yum安装指定版本的Nginx</a></li>
<li><a href="https://code.ziqiangxuetang.com/django/django-nginx-deploy.html">Django部署(Nginx)</a></li>
<li><a href="http://blog.51cto.com/mbb97/2151933">结合Nginx+uWsgi部署Django项目</a></li>
</ul>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a><a class="link-muted mr-2" rel="tag" href="/tags/Django/">Django</a><a class="link-muted mr-2" rel="tag" href="/tags/Nginx/">Nginx</a><a class="link-muted mr-2" rel="tag" href="/tags/uWsgi/">uWsgi</a><a class="link-muted mr-2" rel="tag" href="/tags/Supervisor/">Supervisor</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="http://static.smileorigin.site/Alipay.jpg" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="http://static.smileorigin.site/Wechatpay.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/linux/vim/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Vim</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/python/advices/"><span class="level-item">EffectivePython Advices Record</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: 'ce1559ff5d9dc7cadb49b0ecb32e468f',
            repo: 'gittalk',
            owner: 'smileorigin',
            clientID: '8fb0efbb7d2496c108f3',
            clientSecret: '376c8cd0ff2283ef21dcf9bd1f8348014402bd24',
            admin: ["smileorigin"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: 'last',
            
            
            enableHotKey: true
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#Python3-环境安装"><span class="mr-2">1</span><span>Python3 环境安装</span></a></li><li><a class="is-flex" href="#将项目传到到服务器"><span class="mr-2">2</span><span>将项目传到到服务器</span></a></li><li><a class="is-flex" href="#使用Virtualenv来创建虚拟环境"><span class="mr-2">3</span><span>使用Virtualenv来创建虚拟环境</span></a></li><li><a class="is-flex" href="#安装配置uWsgi"><span class="mr-2">4</span><span>安装配置uWsgi</span></a></li><li><a class="is-flex" href="#安装配置Nginx"><span class="mr-2">5</span><span>安装配置Nginx</span></a></li><li><a class="is-flex" href="#使用Supervisor来管理进程"><span class="mr-2">6</span><span>使用Supervisor来管理进程</span></a></li><li><a class="is-flex" href="#错误解决方案"><span class="mr-2">7</span><span>错误解决方案</span></a></li><li><a class="is-flex" href="#参考文章"><span class="mr-2">8</span><span>参考文章</span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">SMILEORIGIN</a><p class="size-small"><span>&copy; 2020 Thomas Woo</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a> <a class="has-link-black-ter" href="//www.beian.miit.gov.cn" target="_blank">闽ICP备18024126号</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large icon-button" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/smileorigin/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://smileorigin.site',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>